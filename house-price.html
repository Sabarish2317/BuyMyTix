<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Linear Regression with TensorFlow.js</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        text-align: center;
      }
      canvas {
        max-width: 800px;
        margin: auto;
      }
      h1 {
        margin-bottom: 20px;
      }
    </style>
  </head>
  <body>
    <h1>Linear Regression: House Price vs Size</h1>
    <canvas id="chart" width="800" height="400"></canvas>
    <p id="status">Training...</p>

    <script>
      // Dataset: Size (sqft) vs. Price ($1000s)
      const sizes = [500, 700, 800, 1000, 1200, 1500];
      const prices = [150, 200, 210, 250, 300, 330];

      // Normalize data for training
      const xs = tf.tensor1d(sizes);
      const ys = tf.tensor1d(prices);

      // Create model
      const model = tf.sequential();
      model.add(tf.layers.dense({ units: 1, inputShape: [1] }));
      model.compile({ optimizer: "sgd", loss: "meanSquaredError" });

      // Train the model
      async function trainModel() {
        await model.fit(xs, ys, {
          epochs: 300,
          callbacks: {
            onEpochEnd: (epoch, logs) => {
              if (epoch % 50 === 0) {
                console.log(`Epoch ${epoch} : loss = ${logs.loss}`);
              }
            },
          },
        });

        document.getElementById("status").textContent = "Training Complete";
        plot();
      }

      // Predict and plot
      async function plot() {
        const chartData = {
          datasets: [
            {
              label: "Original Data",
              data: sizes.map((size, i) => ({ x: size, y: prices[i] })),
              backgroundColor: "blue",
              pointRadius: 5,
            },
            {
              label: "Regression Line",
              data: [],
              type: "line",
              borderColor: "red",
              fill: false,
              tension: 0,
            },
          ],
        };

        // Predict y for x values
        const lineX = [400, 1600];
        const preds = model.predict(tf.tensor1d(lineX));
        const predYs = await preds.array();

        chartData.datasets[1].data = [
          { x: lineX[0], y: predYs[0] },
          { x: lineX[1], y: predYs[1] },
        ];

        // Draw chart
        new Chart(document.getElementById("chart"), {
          type: "scatter",
          data: chartData,
          options: {
            scales: {
              x: { title: { display: true, text: "Size (sqft)" } },
              y: { title: { display: true, text: "Price ($1000s)" } },
            },
          },
        });
      }

      trainModel();
    </script>
  </body>
</html>
